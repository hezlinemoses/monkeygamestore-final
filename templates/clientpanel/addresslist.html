{% extends 'clientpanel/account_base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% block dynamic_css %} <link rel="stylesheet" href="{% static 'styles/clientpanel/addresslist.css' %}"> {% endblock dynamic_css %}

{% block dynamic %}
{% if messages %}

                    {% for message in messages %}
                        
                          <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
                          <script>
                            Swal.fire({
                              icon: 'success',
                              
                              text: "{{message}}",
                            })
                          </script>
                        
                    {% endfor %}
                    {% endif %}

<h4 class='fw-bold mt-3 ms-4'>Saved Addresses</h4>
<!-- Button trigger modal -->
<button type="button" class="btn btn-primary ms-4" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
  Add New Address
</button>

<div class="row ms-2 mt-3">
    
  {% for address in addresslist %} 

    <div class="col-11 col-md-6 col-xl-4 col-lg-4 mb-3" id="address-{{address.id}}">
      <div class="card" >
          <ul class="list-group list-group-flush ">
            <li class="list-group-item bg-bg d-flex flex-column justify-content-between" >
              {% for field in address.active_address_fields %}
              {{field}}
              {% endfor %}
              <div class=" mb-1">Name : {{address.first_name}} {{address.last_name}}</div>
              <div class=" mb-1">{{address.line_1}},</div>
              <div class=" mb-1">{{address.district}},</div>
              <div class="mb-1">{{address.state}},</div>
              <div class=" fw-bold mb-1">{{address.pincode}}</div>
              <div class=" mb-1">Phone: {{address.phone}}</div>
              <div class=" ms-auto">
                <i class="fas fa-edit text-success" data-bs-toggle="modal" data-bs-target="#staticBackdrop{{address.id}}"></i>
                {% comment %} <a style="text-decoration: none;" href= "{% url 'addressdelete' address.id %}"> {% endcomment %}
                  <i id="{{address.id}}"style="color:red" onclick="confirmDelete(this.id)">
                  <div class="fas fa-trash text-danger ms-2"></div></i>
                  {% comment %} </a> {% endcomment %}
              </div>
               
               

            </li>
          </ul>
        </div>
    </div>








    <!-- Modal LOOP for iframe edit-->
<div class="modal fade" class='close-modal' id="staticBackdrop{{address.id}}" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable bg-dark">
    <div class="modal-content bg-dark">
      <div class="modal-header bg-dark">
        <h5 class="modal-title bg-dark" id="staticBackdropLabel">Edit Address</h5>
        <button type="button" class="btn-close btn-success" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
       
      <iframe src="{% url 'addressedit' address.id %}" width="100%" height="380" frameborder="0" sandbox="allow-same-origin allow-scripts allow-popups allow-forms allow-top-navigation"
                        allowtransparency="true"></iframe>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        {% comment %} <button type="submit" class="btn btn-primary">Submit</button> {% endcomment %}
      </div>
    </div>
  </div>
</div>



    {% endfor %}
   
</div>









<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable bg-dark">
    <div class="modal-content bg-dark">
      <div class="modal-header bg-dark">
        <h5 class="modal-title bg-dark" id="staticBackdropLabel">Add New Address</h5>
        <button type="button" class="btn-close btn-success" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form action="" method='post'>
          {% csrf_token %}
          {{form|crispy}}
      
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
      
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        {% comment %} <button type="submit" class="btn btn-primary">Submit</button> {% endcomment %}
      </div>
    </div>
  </div>
</div>



{% endblock dynamic %}

{% block extrascript %}
<script>
  {% if form.errors %}
      {% comment %} document.getElementById("staticBackdrop").showModal();  {% endcomment %}
      $(window).on('load', function() {
        $('#staticBackdrop').modal('show');
    });
  {% endif %}
</script>
<script>
  function confirmDelete(id){
    console.log(id);
    var result  = confirm('Are you sure you want to delete this address?');
    if(result){
      $.ajax({
        data:{'greet':'I want to delete this address'},
        url:`/account/address/delete/${id}`,
        success: function(response){
          toastr.success(response.message);
          $(`#address-${id}`).hide('slow');
        },
        error: function(response){
          alert('Sorry... Please try again later');
        }
      });
    }
    else
    {
      console.log('User cancelled.. meh....')
    }
    
  }
</script>
{% endblock extrascript %}